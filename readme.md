```md
# ChatGPT CLI

A self-contained **CLI tool** for ChatGPT-like conversations via the OpenAI API. This CLI supports:

- **Normal mode**: Streams tokens in real-time, giving a “typing” effect.
- **Markdown mode**: Displays a spinner while loading, then renders the full response (with **Markdown formatting**).
- **Session Commands**:
  - `/ns` for a new session (normal mode),
  - `/nsm` for a new session (markdown mode),
  - `/quit` to exit the program,
  - or press **Enter** on an empty line to exit.

It can be bundled into a single executable via [`pkg`](https://github.com/vercel/pkg), and it reads configuration (API keys, etc.) from **`~/.config/cgpt/cgpt.env`** if you wish.

---

## Features

1. **Streaming**  
   In **Normal mode**, partial tokens are printed as they arrive from OpenAI’s streaming endpoint.

2. **Markdown Mode**  
   In **Markdown mode**, the script shows a **spinner** while the response is being fetched, then prints the entire reply **rendered** as Markdown (using [marked](https://www.npmjs.com/package/marked) and [marked-terminal](https://www.npmjs.com/package/marked-terminal)).

3. **Session Commands**  
   - **`/ns`** – Start a **new session** in normal mode (no prior conversation context).
   - **`/nsm`** – Start a **new session** in markdown mode (no prior conversation context).
   - **`/quit`** – Exit the CLI immediately.
   - Empty **Enter** – Exit the CLI as well.

4. **Environment-Based Config**  
   - Looks for `API_KEY` and `MODEL` in `~/.config/cgpt/cgpt.env`, then uses environment variables if those aren’t found, then uses CLI arguments (like `--apikey`) as an override.

5. **Command-Line Arguments**  
   - `--apikey <KEY>`: supply the OpenAI API key directly.
   - `--markdown`: begin in **Markdown** mode from the very first message.
   - `"[prompt]"`: an optional initial prompt you can pass right on the command line.

---

## Requirements

- **Node.js** 18+ (if running directly via `node`)  
  or  
- A **bundled binary** generated by [pkg](https://github.com/vercel/pkg) (no separate Node install required).

---

## Installation & Setup

### 1. Clone & Install Dependencies

```bash
git clone <your-repo-url> chatgpt-cli
cd chatgpt-cli
npm install
```

### 2. (Optional) Provide Configuration via `~/.config/cgpt/cgpt.env`

Create a file at `~/.config/cgpt/cgpt.env`:

```bash
mkdir -p ~/.config/cgpt
nano ~/.config/cgpt/cgpt.env
```

Inside `cgpt.env`, you can place:

```
API_KEY=sk-12345abc
MODEL=gpt-4
```

*(You can omit `MODEL` if you want, and it’ll default to gpt-4. If `API_KEY` is not set here, you must pass `--apikey` or set `export API_KEY=...` in your shell.)*

### 3. Running Locally (Without Packaging)

If you have **Node 18+** installed, simply:

```bash
node cgpt.js --apikey <YOUR_API_KEY> "Hello"
```

Or rely on `~/.config/cgpt/cgpt.env` instead of `--apikey`.

### 4. Building a Single Binary with `pkg`

To create a **standalone binary** (so you don’t need Node on the target machine):

1. Install `pkg` if you haven’t already:

   ```bash
   npm install --global pkg
   ```

2. In the project folder, run:

   ```bash
   npm run build
   ```

   *(Assuming your `package.json` has a script like `"build": "pkg cgpt.js --targets node18-linux-x64 --output dist/cgpt"`, or you specify your desired OS/Node version.)*

3. The output binary (e.g., `dist/cgpt`) can be distributed as a **single file**.

#### 4a) System-Wide Installation

To install the binary system-wide:

```bash
sudo cp dist/cgpt /usr/local/bin/cgpt
sudo chmod +x /usr/local/bin/cgpt
```

Now you can run `cgpt` from anywhere in your shell.

---

## Usage

1. **`cgpt "Hello world"`**  
   - Start a conversation, *Normal mode* by default.
2. **`cgpt --markdown "Hello world"`**  
   - Start in *Markdown mode* with an initial prompt.
3. **`cgpt --apikey sk-XXXX "Hello"`**  
   - Provide an API key via CLI argument.

Once running, the CLI shows a prompt:

```
You:
```

Type your message and press Enter. The script will either stream partial tokens or show a spinner, depending on the mode.

### Session Commands

- **`/ns`**  
  - Start a **new session** in normal mode (erases previous conversation).
- **`/ns <message>`**  
  - Same as above, but immediately sends `<message>` as the first user prompt in the new session.
- **`/nsm`**  
  - Start a **new session** in Markdown mode.
- **`/nsm <message>`**  
  - New markdown session with an immediate user prompt `<message>`.
- **`/quit`**  
  - Exit the CLI immediately.
- Press **Enter** on an **empty line** to exit or use **Ctrl+C**.

---

## Examples

**Local `.env` approach**:

```
~/.config/cgpt/cgpt.env:
  API_KEY=sk-12345
  MODEL=gpt-4
```

Then just run:

```bash
./cgpt.js "Hello"
```

*(No need for `--apikey`.)*

**Markdown from the Start**:

```bash
./cgpt.js --markdown
```

Inside the chat:

```
You: /nsm Let's do a markdown table
---
Started a new session in Markdown mode ---

Assistant (Markdown):
| Column | Value  |
|--------|--------|
| ...
```

**Exiting**:
- Type `/quit`, or
- Press Enter on an empty line, or
- Ctrl+C.

---

## Known Limitations

1. **Token Limits**  
   If your conversation becomes very long, you might hit the model’s token limit. You can start a new session (`/ns` or `/nsm`) if that happens.

2. **Missing API Key**  
   If you’re missing `API_KEY`, the script will error. Provide it via command line, environment, or config file.

3. **Multi-Platform**  
   If you build a binary for Linux using `pkg`, it won’t necessarily run on macOS or Windows. You’d create separate binaries per target (e.g., `--targets node18-linux-x64,node18-macos-x64`).

---

## Contributing

Feel free to open issues or pull requests if you’d like to enhance functionality—such as adding conversation summarization, logging, or custom system prompts.

---

## License

This project is licensed under [AGPL-3.0](https://www.gnu.org/licenses/agpl-3.0.html), as specified in the `package.json`.

---

**Enjoy your ChatGPT CLI!**
```

